- job-template:
    name: 'gate-{name}-buildpackage'
    concurrent: false
    block-downstream: true

    triggers:
      - zuul

    builders:
      - gerrit-git-prep
      - buildpackage

    publishers:
      - dpkg-buildpackage:
          artifacts: 'debian/tmp/{name}_*'
      - trigger:
          project: 'gate-{name}-pbuilder-amd64, gate-{name}-pbuilder-i386'
      - console-log

    node: '{node}'

- job-template:
    name: 'gate-{name}-pbuilder-amd64'
    concurrent: false

    builders:
      - copyartifact:
          project: 'gate-{name}-buildpackage'
          filter: 'debian/tmp/{name}_*'
      - shell: |
          /usr/local/bin/pbuilder-{node}-amd64 build debian/tmp/{name}_*.dsc

    publishers:
      - console-log

    node: '{node}'

- job-template:
    name: 'gate-{name}-pbuilder-i386'
    concurrent: false

    builders:
      - copyartifact:
          project: 'gate-{name}-buildpackage'
          filter: 'debian/tmp/{name}_*'
      - shell: |
          /usr/local/bin/pbuilder-{node}-i386 build debian/tmp/{name}_*.dsc

    publishers:
      - console-log

    node: '{node}'
