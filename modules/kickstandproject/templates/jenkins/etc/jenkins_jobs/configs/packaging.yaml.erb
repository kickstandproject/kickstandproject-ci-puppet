- job-template:
    name: 'gate-{name}-buildpackage'
    concurrent: false

    triggers:
      - zuul

    builders:
      - gerrit-git-prep
      - buildpackage

    publishers:
      - dpkg-buildpackage:
          artifacts: 'debian/tmp/{name}_*'
      - console-log

    node: '{node}'

- job-template:
    name: 'gate-{name}-pbuilder-{arch}'
    concurrent: false

    triggers:
      - zuul

    builders:
      - copyartifact:
          project: 'gate-{name}-buildpackage'
          filter: 'debian/tmp/{name}_*'
      - shell: |
          rm -rf result
          sudo /usr/local/bin/pbuilder-{node}-{arch} build --buildresult "`pwd`/result" debian/tmp/{name}_*.dsc
          # Remove copied artifact
          rm -rf debian

    publishers:
      - pbuilder:
          artifacts: 'result/*'
      - console-log

    node: '{node}'

- job-template:
    name: 'ppa-{name}-experimental'

    triggers:
      - zuul-post

    builders:
      - copyartifact:
          project: 'gate-{name}-buildpackage'
          filter: 'debian/tmp/{name}_*'

    publishers:
      - sppa
      - console-log
