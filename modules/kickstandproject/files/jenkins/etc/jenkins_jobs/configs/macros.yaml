# This file is generated by Puppet
#  DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
#
- builder:
    name: gerrit-git-prep
    builders:
      - shell: "/usr/local/jenkins/slave_scripts/gerrit-git-prep.sh review.kickstand-project.org"

- builder:
    name: coverage
    builders:
      - shell: |
          export NOSE_COVER_HTML=1
          tox -ecover

- builder:
    name: docs
    builders:
      - shell: "set -o pipefail ; tox -v -edocs | tee sphinx.txt ; set +o pipefail"

- builder:
    name: pep8
    builders:
      - shell: "set -o pipefail ; tox -v -epep8 | tee pep8.txt ; set +o pipefail"

- builder:
    name: puppet-lint
    builders:
      - shell: "rake lint"

- builder:
    name: puppet-spec
    builders:
      - shell: "rake spec"

- builder:
    name: puppet-syntax
    builders:
      - shell: |
          find . -iname *.pp | xargs puppet parser validate --modulepath=`pwd`/modules
          for f in `find . -iname *.erb` ; do
            erb -x -T '-' $f | ruby -c
          done

- builder:
    name: python27
    builders:
      - shell: "set -o pipefail ; tox -v -epy27 | tee py27.txt ; set +o pipefail"

- builder:
    name: tarball
    builders:
      - shell: |
          #!/bin/bash -xe
          rm -rf dist/*.tar.gz
          tox -evenv python setup.py sdist
          echo "SHA1sum: "
          sha1sum dist/*
          echo "MD5sum: "
          md5sum dist/*

# ============================================================================

- publisher:
    name: pbuilder
    publishers:
      - archive:
          artifacts: '{artifacts}'
          latest_only: true

- publisher:
    name: pep8
    publishers:
      - violations:
          pep8:
            min: 0
            max: 1
            unstable: 1
            pattern: '**/pep8.txt'

- publisher:
    name: tarball
    publishers:
      - archive:
          artifacts: 'dist/*.tar.gz'
      - scp:
          site: '{site}'
          files:
            - target: 'tarballs/{project}/'
              source: 'dist/*.tar.gz'
